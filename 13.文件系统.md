# 文件系统

https://segmentfault.com/a/1190000023615225

文件系统是操作系统中负责管理长期数据的子系统，负责管理计算机的存储设备上的长期数据，主要功能是组织、管理数据的存储、访问和保护，提供了对磁盘空间的抽象，使得操作系统能够以结构化的方式来存储和读取文件。

文件系统的基本数据单位是文件，按照不同的组织方式，会形成不同的文件系统

Linux 最经典的一句话是：「**一切皆文件**」，不仅普通的文件和目录，就连块设备、管道、socket 等，也都是统一交给文件系统管理的

ps：块设备：硬盘，SSD等提供数据存储的介质；管道：进程间通信（IPC）机制，允许一个进程的输出作为另一个进程的输入；socket：网络通信的编程接口，提供不同计算机之间的数据传输能力。

Linux文件系统会为每个文件分配两个数据结构：**索引节点**（index node）和**目录项**（directory entry），主要用来记录文件的元信息和目录层次结构

索引节点：也就是 *inode*，用来记录文件的元信息（除了文件名之外的所有重要属性），比如 inode 编号、文件大小、访问权限、创建时间、修改时间、硬链接计数（多少个目录项指向该inode）、数据块指针（保存文件数据存放的磁盘位置，可以是直接指针，也可以是间接指针）等等。索引节点是文件的**唯一**标识，它们之间一一对应，也同样都会被存储在硬盘中，所以**索引节点同样占用磁盘空间**，并且索引节点都被存储在磁盘的固定位置并按照固定的顺序存储，空间是有限的，也就是文件数量有上限。inode是文件的物理表示，文件名是指向inode的逻辑表示，文件的实际内容不存储在inode中，而是存储在数据块中。

目录项：也就是 *dentry*，用来记录文件的名字、**索引节点指针**以及 与其他目录项的层级关联关系（父子关系）。多个目录项关联起来，目录项用于实现文件系统的层级结构。例如，根目录、子目录、文件等，都通过目录项建立起从根目录到文件的路径关系。目录项的存在使得文件系统能够通过文件路径（文件名）找到对应的 inode，从而获取文件的元数据和数据内容。目录项不是直接存储在磁盘上的。它们由内核在内存中管理，缓存在内存中以提高访问效率。当你列出目录中的文件（ls）时，实际上是内核通过查询内存中的目录项来获取文件名和它们对应的 inode。

文件系统通过目录项建立文件路径，例如 `/home/user/file.txt`，每一层目录（`home`、`user`、`file.txt`）都有一个对应的目录项，指向该层的 inode。当访问文件 `/home/user/file.txt` 时，内核会通过目录项找到 `home` 目录的 inode，再通过 `home` 的目录项找到 `user` 目录的 inode，依此类推，最终访问 `file.txt` 的 inode，获得文件的元数据。



用户访问某个文件，文件系统通过文件名找到对应的目录项，然后从目录项中获取inode编号，通过inode编号找到inode，读取其中的元数据并访问文件的数据块。



