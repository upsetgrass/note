```makefile
MDs=$(shell find docs/ -name "*.md") \
		$(patsubst src/main/scala/%.scala,docs/%_scala.md,$(wildcard src/main/scala/*.scala))
```

这里有两个部分，从右至左执行，先执行$(patsubst ...)，由于patsubst中内嵌了一个指令，所以执行patsubst之前先执行内嵌的指令wildcard，最后执行find，将最后结果存储到MDs

1、wildcard src/main/scala/*.scala   wildcard是makefile中的关键字，用于简单的字符串匹配，比find效率更高，如果现在src/main/scala中有aplic.scala和imsic.scala两个文件，生成src/main/scala/imsic.scala src/main/scala/aplic.scala ...  

patsubst src/main/scala/%.scala, docs/%\_scala.md，patsubst也是makefile中的关键字，语法是$(patsubst \<pattern>, \<replacement>, \<text>)，也就是将第一步拿到的结果text替换为docs/\*_scala.md

2、shell find docs/ -name \"*\.md\*" 调用shell命令，执行find指令，找到docs目录下的所有md文件（递归寻找），docs/imsic.md docs/aplic.md



然后将两步得到的结果进行拼接，给到MDs

：docs/imsic.md docs/aplic.md docs/imsic_scala.md docs/aplic_scala.md

```makefile
PYSVGs=$(subst _dot.py,_py.svg,$(shell find docs/ -name "*_dot.py"))
```

subst字符串替换，\$(subst from, to, text)  from-需要被替换的子字符串  to-替换后的新子字符串  text-原始文本

所以这个指令的意思就是，先通过find指令寻找到docs/下所有以\_dot.py结尾的文件，将其作为原始文本，将原始文本中所有的\_dot.py替换为\_py.svg，然后将替换后的文件存放到PYSVGs

```makefile
DOTSVGs=$(subst .dot,.svg,$(shell find docs/ -name "*.dot"))
```

DOTSVGs同理，将.dot结尾的替换为.svg

```makefile
doc: $(MDs) $(PYSVGs) $(DOTSVGs)
	mdbook build
```

doc是一个目标，后面这三个是依赖，

MDs是一个引用，\$(MDs)就可以使用MDs存储的内容

如果依赖中有发生变化，在执行make doc时，那么就执行`mdbook build`

无论依赖中是否有更新，都去执行 mdbook build 使用`make -B doc`指令

mdbook build是用于生成可视化文档的

mdbook build执行时会在该目录中寻找book.toml文件，如下所示

```toml
[book]
authors = ["xieby1"]
language = "en"
multilingual = false
src = "docs/"
title = "ChiselAIA"

[output.html]
git-repository-url = "https://openxiangshan.github.io/ChiselAIA/"
mathjax-support = true
```

该book.toml中包含了作者，默认语言，是否开启多语言版本、在哪里寻找markdown文件，文档的书名

下面git-repository-url，用于 mdbook 生成的页面中，提供 "Edit this page" 之类的功能，让用户跳转到 GitHub 仓库查看 Markdown 源文件。

mathjax-support = true，允许 mdbook 解析 LaTeX 公式，使 Markdown 文件中的数学公式可以正确渲染

这也就说明了，执行mdbook build时为什么mdbook指令知道需要到docs/下寻找.md

```makefile
docs/images/arch_configure_py.dot: docs/images/arch_common.py
docs/images/arch_interrupt_py.dot: docs/images/arch_common.py
docs/images/example_py.dot: docs/images/example_common.py
docs/images/example-axi_py.dot: docs/images/example_common.py
%_py.dot: %_dot.py
	python3 $<
```

这里有两个部分，上面四个是依赖关系，arch_configure_py.dot依赖于docs/images/arch_common.py

%\_py.dot: %\_dot.py是通配规则，定义了如何将依赖与目标产生关系。

\$<是代指第一个依赖项

可以理解为第一部分指定了 .dot 文件与对应的 .py 文件的依赖关系，而 第二部分则指定了如何从 .py 文件生成 .dot 文件

```makefile
%.svg: %.dot
	dot -Tsvg $< -o $@
	sed -i 's/\([0-9]\+\)pt/\1px/g' $@
```

这里就是依赖于.dot生成.svg

